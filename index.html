<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>App beb√© ‚Äî L√©o</title>
<link rel="stylesheet" href="css/styles.css" />

<!-- Configuraci√≥n PWA y tema -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a84ff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="App L√©o">

<!-- √çconos de la aplicaci√≥n -->
<link rel="icon" href="img/icon/icon-square-180.png" type="image/png"> <!-- √çcono principal -->
<link rel="apple-touch-icon" href="img/icon/icon-square-180.png"> <!-- √çcono para iOS -->

<style>
  #app-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background-image: var(--hero-image);
    background-position: center center;
    background-size: cover;
    background-repeat: no-repeat;
    transform-origin: center center;
    animation: ken-burns 30s ease-in-out infinite alternate;
    transition: background-image 1.2s ease-in-out;
  }
  @keyframes ken-burns {
    0% { transform: scale(1); }
    100% { transform: scale(1.12); }
  }

  /* Stats & Milestones Styles */
  .segmented-control {
    display: flex;
    background: rgba(118, 118, 128, 0.12);
    padding: 2px;
    border-radius: 8px;
    margin-bottom: 16px;
  }
  .segmented-control button {
    flex: 1;
    border: none;
    background: transparent;
    padding: 8px 4px;
    font-size: 0.9rem;
    font-weight: 500;
    border-radius: 6px;
    color: inherit;
    transition: background 0.2s, box-shadow 0.2s;
  }
  .segmented-control button.active {
    background: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    color: #000;
  }
  .dark-mode .segmented-control button.active {
    background: #636366;
    color: #fff;
  }
  .comparison-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 16px;
  }
  .comparison-card {
    background: rgba(255,255,255,0.5);
    border-radius: 16px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .dark-mode .comparison-card { background: rgba(255,255,255,0.05); }
  .comparison-card.primary { background: var(--bg-card, #fff); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
  .dark-mode .comparison-card.primary { background: #1c1c1e; }
  .comp-label { font-size: 0.8rem; opacity: 0.7; text-transform: uppercase; letter-spacing: 0.5px; }
  .comp-value { font-size: 1.5rem; font-weight: 700; }
  .comp-sub { font-size: 0.85rem; opacity: 0.8; display: flex; align-items: center; gap: 4px; }
  .trend-up { color: #34c759; }
  .trend-down { color: #ff3b30; }
  .milestone-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-card, #fff); border-radius: 12px; margin-bottom: 8px; }
  .milestone-icon { font-size: 1.5rem; background: rgba(0,0,0,0.05); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
  .milestone-content { flex: 1; }
  .milestone-date { font-size: 0.8rem; opacity: 0.6; }
  .milestone-title { font-weight: 600; }
  .custom-settings { background: rgba(0,0,0,0.03); padding: 12px; border-radius: 12px; margin-bottom: 16px; }
  .toggle-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,0.05); }
  .toggle-row:last-child { border-bottom: none; }
  .chart-type-selector { display: flex; gap: 8px; margin-top: 8px; }

  /* --- Mobile UX Optimizations --- */
  :root {
    --gap-stack: 12px;
    --container-padding: 16px;
    --safe-top: env(safe-area-inset-top, 20px);
  }

  body {
    min-height: 100vh;
    min-height: 100dvh;
    /* Prevent bounce on iOS if content fits */
    overscroll-behavior-y: none; 
  }

  #app-container {
    /* Use safe area for top padding, plus a bit of breathing room */
    padding-top: max(var(--safe-top), 12px);
    padding-left: var(--container-padding);
    padding-right: var(--container-padding);
    padding-bottom: 80px; /* Space for potential bottom nav or just scroll clearance */
    gap: var(--gap-stack);
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    box-sizing: border-box;
  }

  /* Compact Header */
  .title-bar {
    margin-bottom: 0;
    padding: 4px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .title-bar h1 {
    font-size: 1.35rem;
    letter-spacing: -0.02em;
  }
  .theme-toggle {
    transform: scale(0.9);
    transform-origin: right center;
  }

  /* Compact Profile Card */
  #leo-card {
    padding: 8px 12px;
    border-radius: 16px;
    min-height: auto;
    margin-bottom: 4px;
    background: rgba(255,255,255,0.7);
    backdrop-filter: blur(12px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.03);
  }
  .dark-mode #leo-card {
    background: rgba(30,30,30,0.6);
  }
  #avatar-btn {
    width: 44px;
    height: 44px;
    font-size: 1.5rem;
  }
  .leo-name {
    font-size: 1.05rem;
    font-weight: 700;
  }
  #leo-summary-info {
    font-size: 0.8rem;
    opacity: 0.8;
  }

  /* Optimized Action Grid */
  .primary-actions {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-bottom: 8px;
  }
  .primary-actions .btn {
    padding: 10px 12px;
    height: auto;
    min-height: 52px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 0.95rem;
    font-weight: 600;
    border-radius: 14px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.06);
  }
  .primary-actions .btn-icon {
    font-size: 1.25rem;
    margin: 0;
  }

  /* Compact Dashboard Summaries */
  .report-line {
    padding: 10px 14px;
    margin: 0;
    border-radius: 14px;
    font-size: 0.85rem;
    display: flex;
    flex-wrap: wrap;
    gap: 6px 10px;
    align-items: center;
    background: var(--bg-card, rgba(255,255,255,0.65));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
  }
  .dark-mode .report-line {
    background: rgba(40,40,40,0.6);
    border-color: rgba(255,255,255,0.05);
  }
  .report-line strong {
    font-size: 0.9rem;
    margin-right: auto;
    color: var(--text-main);
  }
  .report-line span, .kpi-pill {
    background: rgba(0,0,0,0.04);
    padding: 3px 8px;
    border-radius: 6px;
    font-weight: 500;
    color: var(--text-muted);
  }
  .dark-mode .report-line span, .dark-mode .kpi-pill {
    background: rgba(255,255,255,0.08);
    color: rgba(255,255,255,0.8);
  }

  /* History Section Tweaks */
  .section-head {
    margin-top: 8px;
    margin-bottom: 8px;
    padding: 0 2px;
  }
  .history-item {
    margin-bottom: 8px;
    border-radius: 14px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  }
  .history-item-foreground {
    padding: 10px 14px;
    background: var(--bg-card, rgba(255,255,255,0.65));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 14px;
  }
  .dark-mode .history-item-foreground {
    background: rgba(40,40,40,0.6);
    border-color: rgba(255,255,255,0.05);
  }
  .item-title {
    font-size: 0.95rem;
    margin-bottom: 2px;
  }
  .item-meta {
    font-size: 0.8rem;
  }

  /* Focus Mode Overlay */
  .focus-overlay {
    position: fixed;
    inset: 0;
    background-color: #000;
    background-image: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.85)), var(--hero-image);
    background-position: center;
    background-size: cover;
    color: #fff;
    z-index: 2000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    padding: 24px;
  }
  .focus-overlay.active {
    opacity: 1;
    pointer-events: auto;
  }
  .focus-minimize-btn {
    position: absolute;
    top: max(20px, env(safe-area-inset-top));
    right: 20px;
    background: rgba(255,255,255,0.2);
    border: none;
    color: #fff;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .focus-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 32px;
    width: 100%;
    max-width: 400px;
  }
  .focus-icon { font-size: 4rem; }
  .focus-label { font-size: 1.5rem; font-weight: 600; opacity: 0.8; margin: 0; }
  .focus-timer { font-size: 5rem; font-weight: 200; font-variant-numeric: tabular-nums; line-height: 1; }
  .focus-meta { font-size: 1.2rem; opacity: 0.6; }
  .focus-action-btn {
    width: 100%;
    padding: 20px;
    font-size: 1.2rem;
    border-radius: 20px;
    background: #ff3b30;
    color: white;
    border: none;
    font-weight: 600;
  }
  .btn-focus-toggle {
    background: transparent;
    border: 1px solid currentColor;
    color: inherit;
    opacity: 0.6;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-left: 8px;
    vertical-align: middle;
  }

  /* Bottle Panel UX Improvements */
  .bottle-time-summary {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px 16px;
    background: rgba(0,0,0,0.03);
    border-radius: 12px;
    margin: 2px 0;
    font-size: 0.95rem;
    color: var(--text-main);
    cursor: pointer;
    transition: background 0.2s;
    user-select: none;
  }
  .bottle-time-summary:active { background: rgba(0,0,0,0.06); }
  .bottle-time-summary .icon-edit { opacity: 0.5; font-size: 1.1em; }
  
  .bottle-details-wrapper {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
  }
  .bottle-details-wrapper.is-open { grid-template-rows: 1fr; margin-bottom: 16px; }
  .bottle-details-inner { min-height: 0; padding: 4px 2px; display: none; }
  .bottle-edit-actions { display: flex; justify-content: flex-end; gap: 12px; margin-top: 12px; }

  /* Bot√≥n Guardar Biber√≥n Destacado */
  #save-biberon {
    background-color: #ff9f0a; /* Naranja vibrante */
    font-size: 1.2rem;
    font-weight: 800;
    padding: 16px;
    margin-top: 16px;
    box-shadow: 0 4px 15px rgba(255, 159, 10, 0.4);
    border: none;
  }

  /* Timeline View Enhancements */
  .list {
    position: relative;
    padding-left: 0;
  }
  
  /* Continuous vertical line */
  .list::before {
    content: '';
    position: absolute;
    top: 12px;
    bottom: 20px;
    left: 15px;
    width: 2px;
    background: rgba(0,0,0,0.08);
    z-index: 0;
  }
  .dark-mode .list::before {
    background: rgba(255,255,255,0.1);
  }

  .history-day-header {
    position: relative;
    z-index: 1;
    padding-left: 42px;
    margin-bottom: 12px;
  }

  .history-item {
    margin-left: 34px;
    position: relative;
    overflow: visible !important;
  }

  /* Timeline Dot */
  .history-item::after {
    content: '';
    position: absolute;
    left: -24px; /* Aligns with the line at left:15px relative to parent list */
    top: 20px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--bg-card, #fff);
    border: 3px solid #ccc;
    z-index: 1;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  /* Type Colors for Timeline Dots */
  .history-item.type-feed::after { border-color: #0a84ff; }
  .history-item.type-elim::after { border-color: #34c759; }
  .history-item.type-med::after { border-color: #ff9f0a; }
  .history-item.type-sleep::after { border-color: #5e5ce6; }
  .history-item.type-pump::after { border-color: #af52de; }
  .history-item.type-measurement::after { border-color: #ff3b30; }
  .history-item.type-milestone::after { border-color: #ffd60a; }

  /* Day Header Dot */
  .history-day-header::before {
    content: '';
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    width: 8px;
    height: 8px;
    background: var(--text-muted);
    border-radius: 50%;
    opacity: 0.5;
    box-shadow: 0 0 0 4px var(--bg-body, #f7fafd); /* Mask line */
  }
  .dark-mode .history-day-header::before {
    box-shadow: 0 0 0 4px #000;
  }
</style>
</head>
<body>
  <div id="app-background"></div>
  <input type="file" id="bg-picker" accept="image/*" style="display:none" />
  <div class="wrap stack" id="app-container">
    <div id="save-indicator" class="save-indicator" data-state="idle" aria-live="polite">
      <span class="save-icon"></span>
      <span id="save-label" class="save-label">Pr√™t</span>
    </div>

    <div class="title-bar">
      <h1>Bonjour, maman ‚ú®</h1>
      <button class="theme-toggle" id="theme-toggle" type="button" aria-pressed="false">
        <span class="theme-toggle-track">
          <span class="theme-toggle-thumb"></span>
        </span>
        <span class="theme-toggle-label">Mode nuit</span>
      </button>
    </div>

    <!-- Avatar L√©o -->
    <div class="card row row-center" id="leo-card">
      <button class="avatar avatar-btn" id="avatar-btn" type="button">üçº</button>
      <div class="col">
        <button class="info-btn" id="info-btn" type="button">
          <div class="leo-name">L√©o</div>
          <div class="muted" id="leo-summary-info">Touchez pour voir les informations</div>
        </button>
      </div>
      <button class="chevron-btn" id="info-chevron" type="button" aria-label="Infos L√©o">‚Ä∫</button>
    </div>

    <!-- Actions principales -->
    <div class="primary-actions">
      <button class="btn btn-primary btn-heartbeat" id="btn-leche" aria-label="Enregistrer une t√©t√©e ou un biberon">
        <span class="btn-icon">üçº</span> Lait
      </button>
      <button class="btn btn-success btn-heartbeat" id="btn-elim" aria-label="Enregistrer un changement de couche ou un vomi">
        <span class="btn-icon">üöº</span> Couche
      </button>
      <button class="btn btn-warning btn-heartbeat" id="btn-med" aria-label="Enregistrer un m√©dicament">
        <span class="btn-icon">üíä</span> M√©dicaments
      </button>
      <button class="btn btn-info btn-heartbeat" id="btn-mesures" aria-label="Enregistrer la temp√©rature, le poids ou la taille">
        <span class="btn-icon">üå°Ô∏è</span> Mesures
      </button>
      <button class="btn btn-sleep btn-heartbeat" id="btn-sleep" type="button" aria-label="Enregistrer le sommeil">
        <span class="btn-icon">üí§</span> Sommeil
      </button>
      <button class="btn btn-primary btn-heartbeat" id="btn-pump" type="button" aria-label="Tirer son lait">
        <span class="btn-icon">üçº</span> Tirer lait
      </button>
    </div>

    <div class="report-line" id="dashboard-elim"></div>
    <div class="report-line" id="summary-feed"></div>
    <div class="report-line" id="summary-sleep"></div>

    <!-- Historial -->
    <div class="stack">
      <div class="section-head">
        <div class="view-switcher">
          <button class="icon-btn" id="history-range-btn" type="button" aria-haspopup="true"  aria-label="Changer la p√©riode du rapport">
            <span class="icon-calendar" aria-hidden="true"></span>
            <span class="label" id="history-range-label">Aujourd'hui</span>
            <span class="caret" aria-hidden="true">‚ñæ</span>
          </button>
          <span class="pill" id="count-pill">0</span>
          <button class="icon-btn icon-btn-secondary icon-only" id="export-pdf" type="button" aria-label="Exporter le rapport en PDF" style="margin-left: auto;">
            <span class="icon-export" aria-hidden="true"></span>
            <span class="spinner" aria-hidden="true"></span>
          </button>
          <button class="icon-btn icon-btn-secondary icon-only" id="export-csv" type="button" aria-label="Exporter en CSV" style="margin-left: 4px;">
            <span style="font-size: 0.7rem; font-weight: 800; letter-spacing: -0.5px;">CSV</span>
          </button>
          <div class="range-menu" id="history-range-menu" role="menu" aria-labelledby="history-range-btn">
            <button class="range-option active" type="button" data-range="day" role="menuitemradio" aria-checked="true">
              <span class="icon-calendar" aria-hidden="true"></span>
              <span>Jour actuel</span>
            </button>
            <button class="range-option" type="button" data-range="week" role="menuitemradio" aria-checked="false">
              <span class="icon-calendar" aria-hidden="true"></span>
              <span>7 derniers jours</span>
            </button>
            <button class="range-option" type="button" data-range="month" role="menuitemradio" aria-checked="false">
              <span class="icon-calendar" aria-hidden="true"></span>
              <span>30 derniers jours</span>
            </button>
            <div class="range-option range-option-custom" data-range="custom" role="menuitemradio" aria-checked="false" tabindex="-1">
              <button class="range-option-custom-trigger" type="button">
                <span class="icon-calendar" aria-hidden="true"></span>
                <span>Choisir une date</span>
              </button>
              <input class="range-date-input" id="history-range-date" type="date" aria-label="S√©lectionner une date sp√©cifique" />
            </div>
          </div>
        </div>
        <div class="history-actions">
          <button class="btn btn-ghost btn-compact" id="add-manual" type="button">Ajouter manuel</button>
          <button class="btn btn-ghost btn-compact btn-stats" id="btn-stats" type="button"><span class="btn-icon">üìà</span> Statistiques</button>
          <button class="btn btn-ghost btn-compact" id="btn-milestones" type="button"><span class="btn-icon">üèÜ</span> √âtapes</button>
        </div>
        <div class="selection-actions is-hidden" id="selection-actions">
          <button class="btn btn-ghost" id="cancel-select-btn" type="button">Annuler</button>
          <button class="btn btn-danger" id="delete-selected-btn" type="button" disabled>
            <span class="btn-icon">üóëÔ∏è</span> Supprimer la s√©lection (0)
          </button>
        </div>
      </div>
      <div class="list" id="history"></div>
    </div>
  </div>

  <!-- Focus Overlay -->
  <div id="focus-overlay" class="focus-overlay" aria-hidden="true">
    <button class="focus-minimize-btn" id="focus-minimize-btn" aria-label="R√©duire">‚úï</button>
    <div class="focus-content">
      <div class="focus-icon" id="focus-icon">‚è±Ô∏è</div>
      <h2 class="focus-label" id="focus-label">Activit√©</h2>
      <div class="focus-timer" id="focus-timer">00:00</div>
      <div class="focus-meta" id="focus-meta"></div>
      <button class="focus-action-btn" id="focus-action-btn">Arr√™ter</button>
    </div>
  </div>

    <div class="modal" id="modal-pump" aria-hidden="true">
      <div class="sheet stack">
        <div class="modal-header">
          <h2>Tirer mon lait</h2>
          <button class="btn btn-ghost btn-compact btn-danger" id="close-pump" type="button">Fermer</button>
        </div>
        <section class="pump-card" id="pump-card" aria-labelledby="pump-card-title">
          <div class="pump-card-head">
            <div>
              <p class="pump-label" id="pump-card-title">Tirage du lait</p>
              <p class="pump-hint">Appuyez pour d√©marrer ou mettre en pause ¬∑ Maintenez pour r√©initialiser</p>
            </div>
            <span class="pump-icon" id="pump-icon" aria-hidden="true">üåÄ</span>
          </div>
          <div class="pump-display" aria-live="polite">
            <span class="pump-timer" id="pump-timer">00:00</span>
            <span class="pump-status" id="pump-status">Pr√™te</span>
          </div>
          <button class="btn btn-pump btn-heartbeat" id="pump-control" type="button">Commencer le tirage</button>
        </section>
      </div>
    </div>



  <!-- Modal LAIT -->
  <div class="modal" id="modal-leche" aria-hidden="true">
    <div class="sheet stack">
      <div class="modal-header">
        <h2>Lait</h2>
        <button class="btn btn-ghost btn-compact btn-danger" id="close-leche">Fermer</button>
      </div>

      <div class="seg">
        <button id="seg-pecho" class="active">Sein</button>
        <button id="seg-biberon">Biberon</button>
      </div>

      <div class="stack" id="feed-content">
        <!-- Pecho -->
        <div id="pane-pecho" class="stack pane-content">
          <div class="seg seg-sides">
            <button id="side-left" class="active">Gauche</button>
            <button id="side-right">Droite</button>
          </div>
          <div class="text-center">
            <div class="time-row"><div class="time" id="chrono">00:00:00</div><button class="btn-focus-toggle" data-focus="breast" aria-label="Mode focus">‚õ∂</button></div>
            <div id="start-time-display" class="muted"></div>
            <button class="btn btn-primary" id="startStop">D√©marrer</button>
          </div>
        </div>

        <!-- Biber√≥n -->
        <div id="pane-biberon" class="stack">
          <div class="text-center">
            <div class="time-row"><div class="time" id="bottle-chrono">00:00:00</div><button class="btn-focus-toggle" data-focus="bottle" aria-label="Mode focus" style="display: none;">‚õ∂</button></div>
            <button class="btn btn-primary" id="startStopBottle">D√©marrer</button>
          </div>

          <!-- Summary / Edit Toggle -->
          <div id="bottle-time-summary" class="bottle-time-summary" role="button" tabindex="0" aria-expanded="false" aria-label="Modifier l'heure">
            <span id="bottle-time-label">Aujourd'hui</span>
            <span class="icon-edit">‚úèÔ∏è</span>
          </div>

          <div id="bottle-details-wrapper" class="bottle-details-wrapper">
            <div class="bottle-details-inner">
              <div class="form-grid">
                <div class="field"><label for="bottle-start">D√©but</label><input id="bottle-start" class="input" type="datetime-local" /></div>
                <div class="field"><label for="bottle-end">Fin</label><input id="bottle-end" class="input" type="datetime-local" /></div>
              </div>
              <div class="bottle-edit-actions">
                <button type="button" class="btn btn-ghost btn-compact" id="cancel-bottle-time">Annuler</button>
                <button type="button" class="btn btn-ghost btn-compact btn-primary" id="confirm-bottle-time">OK</button>
              </div>
            </div>
          </div>
          <div id="bottle-form" class="stack">
            <div class="field field-padded" id="bottle-amount-field">
              <label for="ml">QuantitAc (ml)</label>
              <div class="bottle-amount-control">
                <button type="button" class="circle-btn volume-step" id="bottle-decrease" aria-label="Retirer 10 ml">-10</button>
                <div class="bottle-amount-input">
                  <input id="ml" class="input" type="number" inputmode="decimal" step="10" min="0" placeholder="ex. 120" />
                  <div id="bottle-amount-feedback" class="amount-feedback" aria-live="polite">Choisissez ou ajustez</div>
                </div>
                <button type="button" class="circle-btn volume-step" id="bottle-increase" aria-label="Ajouter 10 ml">+10</button>
              </div>
              <div class="preset-amounts" id="bottle-preset-buttons" role="group" aria-label="QuantitAcs suggAcrAces">
                <button type="button" class="preset-btn" data-value="90">90 ml</button>
                <button type="button" class="preset-btn" data-value="120">120 ml</button>
                <button type="button" class="preset-btn" data-value="130">130 ml</button>
                <button type="button" class="preset-btn" data-value="140">140 ml</button>
                <button type="button" class="preset-btn" data-value="150">150 ml</button>
              </div>
            </div>
            <button class="btn btn-primary" id="save-biberon">Enregistrer</button>
          </div>
        </div>


        <div class="stack" id="feed-history-section">
          <strong>Aujourd'hui</strong>
          <div class="list" id="feed-history"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal SOMMEIL -->
  <div class="modal" id="modal-sleep" aria-hidden="true">
    <div class="sheet stack">
      <div class="modal-header">
        <h2>Sommeil</h2>
        <button class="btn btn-ghost btn-compact btn-danger" id="close-sleep" type="button">Fermer</button>
      </div>
      <div class="stack">
        <div class="text-center">
          <div class="time-row"><div class="time" id="sleep-chrono">00:00:00</div><button class="btn-focus-toggle" data-focus="sleep" aria-label="Mode focus">‚õ∂</button></div>
          <div class="muted" id="sleep-start-time-display"></div>
          <button class="btn btn-primary" id="startStopSleep" type="button">D√©marrer</button>
        </div>
        <div class="form-grid">
          <div class="field">
            <label for="sleep-start">D√©but</label>
            <input id="sleep-start" class="input" type="datetime-local" />
          </div>
          <div class="field">
            <label for="sleep-end">Fin</label>
            <input id="sleep-end" class="input" type="datetime-local" />
          </div>
        </div>
        <div class="field">
          <label for="sleep-notes">Notes</label>
          <textarea id="sleep-notes" class="input textarea" rows="2" placeholder="Sieste, nuit compl√®te, etc."></textarea>
        </div>
        <div class="footer">
          <button class="btn btn-ghost btn-danger" id="cancel-sleep" type="button">Annuler</button>
          <button class="btn btn-primary" id="save-sleep" type="button">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal ELIMINACIONES -->
  <div class="modal" id="modal-elim" aria-hidden="true">
    <div class="sheet stack">
      <div class="modal-header">
        <h2>Pipi / Caca / Vomi</h2>
        <button class="btn btn-ghost btn-compact btn-danger" id="close-elim">Fermer</button>
      </div>

      <div class="stack">
        <div class="field">
          <label>Pipi</label>
          <div class="scale" data-scale="pee"></div>
        </div>
        <div class="field">
          <label>Caca</label>
          <div class="scale" data-scale="poop"></div>
        </div>
        <div class="field">
          <label>Vomi</label>
          <div class="scale" data-scale="vomit"></div>
        </div>
      </div>

      <div class="report-line" id="summary-elim"></div>

      <div class="footer">
        <button class="btn btn-ghost btn-danger" id="cancel-elim">Annuler</button>
        <button class="btn btn-primary" id="save-elim">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Modal MEDICAMENTS -->
  <div class="modal" id="modal-med" aria-hidden="true">
    <div class="sheet stack">
      <div class="modal-header">
        <h2>Medicaments</h2>
        <button class="btn btn-ghost btn-compact btn-danger" id="close-med" type="button">Fermer</button>
      </div>

      <div class="stack">
        <div class="field">
          <label for="medication-select">Choisir un medicament</label>
          <select id="medication-select" class="input">
            <option value="ibufrone">Ibufrone</option>
            <option value="dalfalgan">Dalfalgan</option>
            <option value="other">Autres...</option>
          </select>
        </div>
        <div class="field is-hidden" id="medication-other-field">
          <label for="medication-other">Nom du medicament</label>
          <input id="medication-other" class="input" type="text" placeholder="Nom du medicament" />
        </div>
        <div class="report-line" id="summary-med"></div>
      </div>

      <div class="footer">
        <button class="btn btn-ghost btn-danger" id="cancel-med" type="button">Annuler</button>
        <button class="btn btn-primary" id="save-med" type="button">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Modal MESURES -->
  <div class="modal" id="modal-mesures" aria-hidden="true">
    <div class="sheet stack">
      <div class="modal-header">
        <h2>Mesures</h2>
        <button class="btn btn-ghost btn-compact btn-danger" id="close-mesures" type="button">Fermer</button>
      </div>

      <div class="stack form-grid">
        <div class="field">
          <label for="mesure-temp">Temp√©rature (¬∞C)</label>
          <input id="mesure-temp" class="input" type="text" inputmode="decimal" step="0.1" placeholder="ex. 37.5" />
        </div>
        <div class="field">
          <label for="mesure-poids">Poids (kg)</label>
          <input id="mesure-poids" class="input" type="text" inputmode="decimal" step="0.01" placeholder="ex. 4.25" />
        </div>
        <div class="field">
          <label for="mesure-taille">Taille (cm)</label>
          <input id="mesure-taille" class="input" type="text" inputmode="decimal" step="0.1" placeholder="ex. 55.5" />
        </div>
      </div>

      <div class="footer">
        <button class="btn btn-ghost btn-danger" id="cancel-mesures" type="button">Annuler</button>
        <button class="btn btn-primary" id="save-mesures" type="button">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Modal MANUAL -->
  <div class="modal" id="modal-manual" aria-hidden="true">
    <div class="sheet stack">
      <div class="row modal-header">
        <h2>Nouvel enregistrement</h2>
        <button class="btn btn-ghost btn-compact btn-danger" id="close-manual" type="button">Fermer</button>
      </div>

      <div class="seg" id="manual-type">
        <button data-type="feed" class="active" type="button"><span class="btn-icon">üçº</span> Lait</button>
        <button data-type="elim" type="button"><span class="btn-icon">üöº</span> Couche</button>
        <button data-type="med" type="button"><span class="btn-icon">üíä</span> M√©dicaments</button>
        <button data-type="measurement" type="button"><span class="btn-icon">üå°Ô∏è</span> Mesures</button>
      </div>

      <div class="stack form-grid" id="manual-feed-fields">
        <div class="field span-2">
          <label for="manual-source">Source</label>
          <select id="manual-source" class="input">
            <option value="breast">Sein</option>
            <option value="bottle">Biberon</option>
          </select>
        </div>
        <div class="field">
          <label for="manual-breast">C√¥t√©</label>
          <select id="manual-breast" class="input">
            <option value="Gauche">Gauche</option>
            <option value="Droite">Droite</option>
            <option value="Les deux">Les deux</option>
          </select>
        </div>
        <div class="field" id="manual-duration-field">
          <label for="manual-duration">Dur√©e (minutes)</label>
          <input id="manual-duration" class="input" type="text" inputmode="numeric" min="0" step="1" placeholder="ex. 12" />
        </div>
        <div class="field is-hidden" id="manual-amount-field">
          <label for="manual-amount">Quantit√© (ml)</label>
          <div class="bottle-amount-control">
            <button type="button" class="circle-btn volume-step" id="manual-bottle-decrease" aria-label="Retirer 10 ml">-10</button>
            <div class="bottle-amount-input">
              <input id="manual-amount" class="input" type="number" inputmode="decimal" min="0" step="10" placeholder="ex. 120" />
              <div id="manual-bottle-feedback" class="amount-feedback" aria-live="polite">Choisissez ou ajustez</div>
            </div>
            <button type="button" class="circle-btn volume-step" id="manual-bottle-increase" aria-label="Ajouter 10 ml">+10</button>
          </div>
          <div class="preset-amounts" id="manual-bottle-preset-buttons" role="group" aria-label="Quantit√©s sugg√©r√©es">
            <button type="button" class="preset-btn" data-value="90">90 ml</button>
            <button type="button" class="preset-btn" data-value="120">120 ml</button>
            <button type="button" class="preset-btn" data-value="130">130 ml</button>
            <button type="button" class="preset-btn" data-value="140">140 ml</button>
            <button type="button" class="preset-btn" data-value="150">150 ml</button>
          </div>
        </div>
        <div class="field span-2">
          <label for="manual-notes">Notes</label>
          <textarea id="manual-notes" class="input textarea" rows="2" placeholder="Observations rapides..."></textarea>
        </div>
      </div>

      <div class="stack form-grid is-hidden" id="manual-elim-fields">
        <div class="field">
          <label for="manual-pee">Pipi</label>
          <input id="manual-pee" class="input" type="text" inputmode="numeric" min="0" max="3" step="1" value="0" />
        </div>
        <div class="field">
          <label for="manual-poop">Caca</label>
          <input id="manual-poop" class="input" type="text" inputmode="numeric" min="0" max="3" step="1" value="0" />
        </div>
        <div class="field">
          <label for="manual-vomit">Vomi</label>
          <input id="manual-vomit" class="input" type="text" inputmode="numeric" min="0" max="3" step="1" value="0" />
        </div>
        <div class="field span-2">
          <label for="manual-elim-notes">Notes</label>
          <textarea id="manual-elim-notes" class="input textarea" rows="2" placeholder="Textures, couleurs, etc."></textarea>
        </div>
      </div>

      <div class="stack form-grid is-hidden" id="manual-med-fields">
        <div class="field">
          <label for="manual-med-select">M√©dicament</label>
          <select id="manual-med-select" class="input">
            <option value="ibufrone">Ibufrone</option>
            <option value="dalfalgan">Dalfalgan</option>
            <option value="other">Autres...</option>
          </select>
        </div>
        <div class="field is-hidden" id="manual-med-other-field">
          <label for="manual-med-other">Nom</label>
          <input id="manual-med-other" class="input" type="text" placeholder="Nom du medicament" />
        </div>
        <div class="field">
          <label for="manual-med-dose">Dose</label>
          <input id="manual-med-dose" class="input" type="text" placeholder="ex. 5 ml" />
        </div>
        <div class="field span-2">
          <label for="manual-med-notes">Notes</label>
          <textarea id="manual-med-notes" class="input textarea" rows="2" placeholder="R√©actions, rappel..."></textarea>
        </div>
      </div>

      <div class="stack form-grid is-hidden" id="manual-mesures-fields">
        <div class="field">
          <label for="manual-mesure-temp">Temp√©rature (¬∞C)</label>
          <input id="manual-mesure-temp" class="input" type="text" inputmode="decimal" step="0.1" placeholder="ex. 37.5" />
        </div>
        <div class="field">
          <label for="manual-mesure-poids">Poids (kg)</label>
          <input id="manual-mesure-poids" class="input" type="text" inputmode="decimal" step="0.01" placeholder="ex. 4.25" />
        </div>
        <div class="field">
          <label for="manual-mesure-taille">Taille (cm)</label>
          <input id="manual-mesure-taille" class="input" type="text" inputmode="decimal" step="0.1" placeholder="ex. 55.5" />
        </div>
      </div>

      <div class="field">
        <label for="manual-datetime">Date &amp; heure</label>
        <input id="manual-datetime" class="input" type="datetime-local" />
      </div>

      <div class="footer">
        <button class="btn btn-ghost btn-danger" id="cancel-manual" type="button">Annuler</button>
        <button class="btn btn-primary" id="save-manual" type="button">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Modal STATS -->
  <div class="modal" id="modal-stats" aria-hidden="true">
    <div class="sheet stack">
      <div class="row modal-header">
        <h2>Statistiques</h2>
        <button class="btn btn-ghost btn-compact btn-danger" id="close-stats" type="button">Fermer</button>
      </div>

      <!-- New Stats UX -->
      <div class="segmented-control" id="stats-view-selector">
        <button type="button" data-view="today" class="active">Aujourd'hui</button>
        <button type="button" data-view="yesterday">Hier</button>
        <button type="button" data-view="week">Semaine</button>
        <button type="button" data-view="custom">Perso</button>
      </div>

      <div id="stats-custom-settings" class="custom-settings is-hidden">
        <div class="form-grid">
          <div class="field">
            <label>Du</label>
            <input type="date" id="stats-custom-start" class="input">
          </div>
          <div class="field">
            <label>Au</label>
            <input type="date" id="stats-custom-end" class="input">
          </div>
        </div>
        <div class="toggle-row">
          <span>Afficher graphiques</span>
          <input type="checkbox" id="stats-toggle-charts" checked>
        </div>
      </div>

      <div class="stack stats-content">
        <div id="stats-dynamic-content"></div>
      </div>
    </div>
  </div>

  <!-- Modal CONFIRM DELETE -->
  <div class="modal" id="modal-confirm-delete" aria-hidden="true">
    <div class="sheet stack">
      <div class="modal-header">
        <h2>Confirmer la suppression</h2>
        <button class="btn btn-ghost btn-compact btn-danger" id="close-confirm-delete" type="button">Fermer</button>
      </div>
      <p id="confirm-delete-message" class="text-center">Voulez-vous vraiment supprimer cet √©l√©ment ?</p>
      <div class="field">
        <label for="security-pin">Code de s√©curit√©</label>
        <input id="security-pin" class="input" type="password" inputmode="numeric" placeholder="Entrez le code pour confirmer" />
      </div>
      <div class="footer">
        <button class="btn btn-ghost btn-danger" id="cancel-confirm-delete" type="button">Annuler</button>
        <button class="btn btn-danger" id="confirm-delete-btn" type="button">Supprimer</button>
      </div>
    </div>
  </div>

  <!-- Modal DATE RANGE PICKER -->
  <div class="modal" id="modal-range-picker" aria-hidden="true">
    <div class="sheet stack">
      <div class="modal-header">
        <h2>Choisir une p√©riode</h2>
        <button class="btn btn-ghost btn-compact btn-danger" id="close-range-picker" type="button">Fermer</button>
      </div>
      <div class="list" id="range-picker-options">
        <button class="range-option-item" data-range="day">
          <span class="icon-calendar"></span>
          <span>Jour actuel</span>
        </button>
        <button class="range-option-item" data-range="week">
          <span class="icon-calendar"></span>
          <span>7 derniers jours</span>
        </button>
        <button class="range-option-item" data-range="month">
          <span class="icon-calendar"></span>
          <span>30 derniers jours</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Modal MILESTONES -->
  <div class="modal" id="modal-milestones" aria-hidden="true">
    <div class="sheet stack">
      <div class="modal-header">
        <h2>√âtapes de d√©veloppement</h2>
        <button class="btn btn-ghost btn-compact btn-danger" id="close-milestones" type="button">Fermer</button>
      </div>
      
      <div class="list" id="milestones-list">
        <!-- Items go here -->
      </div>

      <div class="stack form-grid" style="margin-top: 16px; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 16px;">
        <h3>Ajouter une √©tape</h3>
        <div class="field">
          <label>Titre</label>
          <input id="milestone-title" class="input" type="text" placeholder="ex. Premier sourire" />
        </div>
        <div class="field">
          <label>Date</label>
          <input id="milestone-date" class="input" type="date" />
        </div>
        <div class="field">
          <label>Ic√¥ne</label>
          <select id="milestone-icon" class="input">
            <option value="üèÜ">üèÜ Troph√©e</option>
            <option value="üòÉ">üòÉ Sourire</option>
            <option value="üó£Ô∏è">üó£Ô∏è Areuh</option>
            <option value="ü¶∑">ü¶∑ Dent</option>
            <option value="üë£">üë£ Pas</option>
            <option value="üß∏">üß∏ Jouet</option>
            <option value="üåü">üåü Autre</option>
          </select>
        </div>
        <button class="btn btn-primary" id="save-milestone" type="button">Ajouter</button>
      </div>
    </div>
  </div>

  <!-- Template para los elementos del historial -->
  <template id="history-item-template">
    <div class="history-item" role="listitem">
      <div class="history-item-background">
        <button class="swipe-delete-btn" type="button" aria-label="Supprimer">
          <span>üóëÔ∏è</span>
        </button>
      </div>
      <div class="history-item-foreground">
        <input type="checkbox" class="history-item-checkbox" aria-label="S√©lectionner cet √©l√©ment">
        <div class="item-content">
          <strong class="item-title"></strong>
          <div class="item-meta"></div>
        </div>
        <div class="item-actions">
          <button class="item-action item-edit" type="button" aria-label="Modifier l'√©l√©ment"><span>‚úèÔ∏è</span></button>
          <button class="item-action item-delete" type="button" aria-label="Supprimer l'√©l√©ment"><span>üóëÔ∏è</span></button>
        </div>
      </div>
    </div>
  </template>

  <!-- Toast pour annuler -->
  <div id="undo-toast" class="undo-toast" role="status" aria-live="polite">
    <span id="undo-message">√âl√©ment supprim√©</span>
    <button id="undo-btn" type="button" class="btn btn-ghost">Annuler</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script type="module" src="js/app.js"></script>
</body>
</html>
